{% extends 'base.html' %}
{% block content %}

<div class="row valign-wrapper">
  <div class="col s12 m8">
      <h1>Cosmic Events</h1>
  </div>
  <div class="col s12 m4 right-align">
      <a class="dropdown-trigger btn" href="#" data-target="filter-dropdown"><span class="material-icons" style="vertical-align:middle; margin-right: 5px;">sort</span>Sort</a>
      <ul id="filter-dropdown" class="dropdown-content">
          <li><a href="?orderby=title">By Name</a></li>
          <li><a href="?orderby=start_date">By Date</a></li>
          <li><a href="?orderby=users_watching">By # of Watchers</a></li>
      </ul>
  </div>
</div>

<div class="row">
    {% for event in event_list %}
      <div class="col s12 m6 l4">
        <a href="{% url 'events_detail' event.id %}" style="color: black;">
          <div class="card">
            <div class="card-image">
              <img src="https://images.pexels.com/photos/4644812/pexels-photo-4644812.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2" height="200px" style="background-color:black;">
              {% if user in event.users_watching.all %}
                <form method="POST" action="{% url 'events_watchlistremove' event.id %}">
                  {% csrf_token %}
                  <input type="hidden" name="next" value="{{ request.path }}">
                  <button type="submit" onclick="M.toast({html: 'Event removed from watchlist.'})" class="btn-floating halfway-fab waves-effect waves-light red tooltipped" data-position="left" data-tooltip="Remove from Watchlist"><i class="material-icons md-24">visibility_off</i></button>
                </form>
              {% else %}
                <form method="POST" action="{% url 'events_watchlist' event.id %}">
                  {% csrf_token %}
                  <input type="hidden" name="next" value="{{ request.path }}">
                  <button type="submit" onclick="M.toast({html: 'Event added to watchlist.'})" class="btn-floating pulse halfway-fab waves-effect waves-light blue tooltipped" data-position="left" data-tooltip="Add to Watchlist"><i class="material-icons md-24">visibility</i></button>
                </form>
              {% endif %}
            </div>
            <div class="card-content">
                <span class="card-title truncate">{{ event.title }}</span>
                <p class="truncate"><i class="tiny material-icons" style="margin-right: 5px;">place</i>{{ event.location }}</p>
                <p><i class="tiny material-icons" style="margin-right: 5px;">event</i>{{ event.start_date }} {% if event.start_time %}@ {{ event.start_time }}{% endif %}</p>
                <p><i class="tiny material-icons" style="margin-right: 5px;">visibility</i>{{ event.users_watching.all|length}} Watching </p>
            </div>
          </div>
        </a>
      </div>
    {% endfor %}
</div>

<script>
  const filterEl = document.querySelector('.dropdown-trigger');
  const tooltipEls = document.querySelectorAll('.tooltipped');
  M.Dropdown.init(filterEl, {
      alignment: 'right',
      coverTrigger: false,
      constrainWidth: false
  });
  M.Tooltip.init(tooltipEls);
</script>

{% endblock %}
